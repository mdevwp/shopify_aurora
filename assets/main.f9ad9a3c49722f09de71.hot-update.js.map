{"version":3,"file":"main.f9ad9a3c49722f09de71.hot-update.js","mappings":"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","sources":["webpack://Aurora/./src/scripts/sections/product/product-form.ts","webpack://Aurora/webpack/runtime/getFullHash"],"sourcesContent":["import { QuickView } from './quick-view'\r\nimport { BaseComponent } from '../../components/base-component'\r\nimport { CartAPI } from '../../api/cart-api'\r\nimport { fetchConfig } from '../../utils/fetch-config'\r\nimport { CartDrawer } from '../cart-drawer/cart-drawer'\r\nimport { CartPage } from '../cart/cart'\r\nimport { BodyElement } from 'src/scripts/components/body-element/body-element'\r\nimport { CartNotificationPopup } from 'src/scripts/components/cart-notification/cart-notification-popup'\r\nimport { $el, $list } from 'src/scripts/utils/utils'\r\nimport { parseHTML, replaceNodeChildren } from 'src/scripts/utils/dom'\r\n\r\nconst CART_DRAWER_SELECTOR = `#CartDrawer`\r\nconst CART_PAGE_SELECTOR = 'cart-page'\r\nconst CART_NOTIFICATION_POPUP_SELECTOR = '#CartNotificationPopup'\r\nconst FORM_SELECTOR = 'form'\r\nconst VARIANT_INPUT_SELECTOR = `[data-product-form-variant]`\r\nconst QUICK_VIEW = '#Quick-view'\r\nconst BODY_ELEMENT_SELECTOR = 'body-element'\r\n\r\nexport class ProductForm extends BaseComponent {\r\n  cartApi: CartAPI = new CartAPI()\r\n  lastParsedState: string\r\n\r\n  mountComponent(): void {\r\n    const form = $el(FORM_SELECTOR, this)\r\n    this.addListener(form, 'submit', this.handleFormSubmit)\r\n  }\r\n\r\n  handleFormSubmit = async (event: SubmitEvent): Promise<void> => {\r\n    event.preventDefault()\r\n\r\n    const config = this.getQueryConfig()\r\n\r\n    this.setDisable(true)\r\n    this.setLoading(true)\r\n\r\n    await this.cartApi\r\n      .add(config)\r\n      .then(state => {\r\n        this.setDisable(false)\r\n        this.setLoading(false)\r\n        const parsedState = JSON.parse(state)\r\n\r\n        if (parsedState.description) {\r\n          this.showError(parsedState)\r\n          return\r\n        }\r\n\r\n        this.lastParsedState = parsedState\r\n        this.updateCartItems(parseHTML(JSON.parse(state).sections[this.cartId]))\r\n      })\r\n      .catch(() => console.log('Error in product form component'))\r\n  }\r\n\r\n  updateCartItems(html) {\r\n    const cartDrawer: CartDrawer = $el(CART_DRAWER_SELECTOR)\r\n    const cart: CartPage = $el(CART_PAGE_SELECTOR)\r\n    const popup: CartNotificationPopup = $el(CART_NOTIFICATION_POPUP_SELECTOR)\r\n\r\n    if (cart) {\r\n      this.updateCart(html)\r\n    } else if (cartDrawer) {\r\n      this.updateCartDrawer(html)\r\n    } else if (popup) {\r\n      this.updatePopup(html)\r\n    } else {\r\n      this.updateCartCount(html)\r\n    }\r\n  }\r\n\r\n  updateCartCount(html): void {\r\n    const newCount = $el('#NewCartCount', html)\r\n    const currentCounts = $list('#CartCount')\r\n\r\n    this.onUpdateCartItems(() => {\r\n      currentCounts.forEach(currentCount => {\r\n        replaceNodeChildren(currentCount, newCount)\r\n      })\r\n    })\r\n  }\r\n\r\n  updateCart(html): void {\r\n    const cart: CartPage = $el(CART_PAGE_SELECTOR)\r\n\r\n    cart?.updateEmptyStatus(false)\r\n    this.onUpdateCartItems(() => {\r\n      cart?.purchaseHandler(html, this.lastParsedState)\r\n    })\r\n  }\r\n\r\n  updateCartDrawer(html): void {\r\n    const cartDrawer: CartDrawer = $el(CART_DRAWER_SELECTOR)\r\n\r\n    cartDrawer?.updateAsideProductsByParsedState(this.lastParsedState)\r\n    cartDrawer?.updateEmptyStatus()\r\n    this.onUpdateCartItems(() => {\r\n      cartDrawer?.purchaseHandler(html, this.lastParsedState)\r\n    })\r\n  }\r\n\r\n  updatePopup(html): void {\r\n    this.onUpdateCartItems(() => {\r\n      const popup: CartNotificationPopup = $el(CART_NOTIFICATION_POPUP_SELECTOR)\r\n      popup?.purchaseHandler(html, this.lastParsedState)\r\n    })\r\n  }\r\n\r\n  async onUpdateCartItems(callback): Promise<void> {\r\n    const quickView: QuickView = $el(QUICK_VIEW)\r\n\r\n    if (quickView.isOpen) {\r\n      quickView.hide().then(callback)\r\n    } else {\r\n      callback()\r\n    }\r\n  }\r\n\r\n  showError(parsedState) {\r\n    const bodyElement: BodyElement = $el(BODY_ELEMENT_SELECTOR)\r\n\r\n    const error =\r\n      typeof parsedState.description === 'object'\r\n        ? this.getErrorFromObject(parsedState.description)\r\n        : parsedState.description\r\n\r\n    bodyElement.showNotification(error, 'warning')\r\n  }\r\n\r\n  getErrorFromObject(errorObject: object) {\r\n    return Object.keys(errorObject)\r\n      .map(key => {\r\n        return `${key}: ${errorObject[key]}`\r\n      })\r\n      .join(' , ')\r\n  }\r\n\r\n  getQueryConfig() {\r\n    const form: HTMLFormElement = $el(FORM_SELECTOR, this)\r\n    const config: any = fetchConfig('javascript')\r\n    const formData: any = new FormData(form)\r\n\r\n    config.headers['X-Requested-With'] = 'XMLHttpRequest'\r\n    delete config.headers['Content-Type']\r\n    formData.append('sections', [this.cartId])\r\n    formData.append('sections_url', window.location.pathname)\r\n    config.body = formData\r\n\r\n    return config\r\n  }\r\n\r\n  setLoading(isLoading: boolean): void {\r\n    $list('button[type=\"submit\"]', this).forEach(button =>\r\n      button.classList.toggle('loading', isLoading),\r\n    )\r\n  }\r\n\r\n  setDisable(isDisable: boolean): void {\r\n    $list('button[type=\"submit\"]', this).forEach(button =>\r\n      button.toggleAttribute('disabled', isDisable),\r\n    )\r\n  }\r\n\r\n  setButtonText(text: string): void {\r\n    $list('button[type=\"submit\"]', this).forEach(\r\n      button => (button.textContent = text),\r\n    )\r\n  }\r\n\r\n  getVeriantInput() {\r\n    const form = $el(FORM_SELECTOR, this)\r\n    const variantInput = $el(VARIANT_INPUT_SELECTOR, form)\r\n\r\n    return variantInput\r\n  }\r\n\r\n  get cartId(): string {\r\n    const cartDrawer: CartDrawer = $el(CART_DRAWER_SELECTOR)\r\n    const cart: CartPage = $el(CART_PAGE_SELECTOR)\r\n\r\n    if (cartDrawer) {\r\n      return cartDrawer.dataset.sectionId\r\n    } else if (cart) {\r\n      return cart.dataset.sectionId\r\n    } else {\r\n      return 'cart-notification-popup-content'\r\n    }\r\n  }\r\n}\r\n","__webpack_require__.h = function() { return \"cb72df2020c2527896b6\"; }"],"names":[],"sourceRoot":""}